<!DOCTYPE html>
<html>
<head>
  <title>NFL Weekly Schedule</title>
</head>
<body style="font-family: Arial; margin: 20px;">

<h1>This Week's Games</h1>
<div id="games"></div>

<script>
// ---------- CONFIG ----------
let startingWeek = 14;
let startingDate = new Date("2025-12-06T16:00:00");
// ----------------------------

// Compute current week
function getCurrentWeek() {
  let now = new Date();
  let diff = now - startingDate;
  let weeksPassed = Math.floor(diff / (7 * 24 * 60 * 60 * 1000));
  return startingWeek + Math.max(0, weeksPassed);
}

// Team â†’ abbreviation
const teamAbbr = {
  "Arizona Cardinals": "ari",
  "Atlanta Falcons": "atl",
  "Baltimore Ravens": "bal",
  "Buffalo Bills": "buf",
  "Carolina Panthers": "car",
  "Chicago Bears": "chi",
  "Cincinnati Bengals": "cin",
  "Cleveland Browns": "cle",
  "Dallas Cowboys": "dal",
  "Denver Broncos": "den",
  "Detroit Lions": "det",
  "Green Bay Packers": "gb",
  "Houston Texans": "hou",
  "Indianapolis Colts": "ind",
  "Jacksonville Jaguars": "jax",
  "Kansas City Chiefs": "kc",
  "Las Vegas Raiders": "lv",
  "Los Angeles Chargers": "lac",
  "Los Angeles Rams": "lar",
  "Miami Dolphins": "mia",
  "Minnesota Vikings": "min",
  "New England Patriots": "ne",
  "New Orleans Saints": "no",
  "New York Giants": "nyg",
  "New York Jets": "nyj",
  "Philadelphia Eagles": "phi",
  "Pittsburgh Steelers": "pit",
  "San Francisco 49ers": "sf",
  "Seattle Seahawks": "sea",
  "Tampa Bay Buccaneers": "tb",
  "Tennessee Titans": "ten",
  "Washington Commanders": "was"
};

// Load CSV
fetch("schedule.csv")
  .then(res => res.text())
  .then(csv => parseCSV(csv));

function parseCSV(csvText) {
  let rows = csvText.trim().split("\n").map(r => r.split(","));
  let headers = rows.shift();
  let week = getCurrentWeek();

  let games = rows.filter(r => Number(r[1]) === week);

  renderGames(games);
}

function renderGames(games) {
  let container = document.getElementById("games");

  if (games.length === 0) {
    container.innerHTML = "<p>No games this week.</p>";
    return;
  }

  container.innerHTML = "";

  games.forEach(game => {
    let date = game[2].split(" ")[0].split("/"); // DD/MM/YYYY
    let yyyy = date[2];
    let mm = date[1].padStart(2, "0");
    let dd = date[0].padStart(2, "0");
    let formattedDate = `${yyyy}-${mm}-${dd}`;

    let home = teamAbbr[game[4]];
    let away = teamAbbr[game[5]];

    let iframeURL = `https://playembed.top/embed/nfl/${formattedDate}/${away}-${home}`;

    let block = `
      <div style="margin-bottom: 25px;">
        <h3>${game[5]} @ ${game[4]}</h3>
        <iframe 
          src="${iframeURL}"
          width="100%" height="500px"
          allowfullscreen allow="encrypted-media; picture-in-picture;"
          frameborder="0">
        </iframe>
      </div>
    `;

    container.innerHTML += block;
  });
}
</script>

</body>
</html>
